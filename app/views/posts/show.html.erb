<div class='post-page container'>
  <div class='post-info'>
    <h1 class="post-info__post-title">
      <%= @post.title %>
    </h1>
    <div class="post-info__post-flags">
      <% if @post.done_flag.present? %>
        <div class="badge badge-success p-2">
          <i class="far fa-check-square"></i>
          達成済
        </div>
      <%end%>
      <% if @post.private_flag.present? %>
        <div class="badge badge-warning p-2">
          <i class="fas fa-lock"></i>
          非公開
        </div>
      <%end%>
    </div>
    <div class="post-info__post-category">
      <%= render 'posts/category_list', category_list: @post.category_list %>
    </div>
    <div class="post-info__post-reputation">
      <%if @post.reputation %>
        <div class="post-reputation-back">
          ★★★★★
        </div>
        <div class="post-reputation-front">
          <% case @post.reputation %>
          <% when 1%>
            ★
          <% when 2%>
            ★★
          <% when 3%>
            ★★★
          <% when 4%>
            ★★★★
          <% when 5%>
            ★★★★★
          <%end%>
        </div>
      <%end%>
    </div>
  </div>
    <%# TODO: 複数画像 スライド表示%>
  <div class='post-info'>
    <div class="post-info__post-images">
      <div class="post-main-image">
        <% if @post.images.present? %>
          <%= image_tag "#{@post.images[0].image.url}", size: "500x280"%>
        <% end %>
      </div>
      <div class="post-image-gallery">
        <% if @post.images.present? %>
          <% @post.images.each do |image|%>
            <%= image_tag "#{image.image.url}", size: "20%x100", class: "images-gallery"%>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="post-info">
    <div class="post-description">
      <%= simple_format @post.description %>
    </div>
    <div class="post-budget">
      <%= "¥#{@post.budget.to_s(:delimited)}" %>
    </div>
    <div class="post-deadline">
      <%= @post.deadline %>
    </div>
    <div class="post-priority">
      <%= @post.priority %>
    </div>
  </div>


  <%# 場所 %>
  <% if @post.address.present? %>
    <div class='post-info'>
      <div class="post-info__post-address">
        <div id="map"></div>
      </div>
    </div>
  <% end %>

  <% if @post.tasks.present? %>
    <div class='post-info'>
      <div class='post-info__tasks-titleBar'>
        <div class='post-info__tasks-titleBar__formTitle'>
          <i class="fas fa-tasks"></i>
          <h5>サブタスクリスト</h5>
        </div>
      </div>
      <ul class="post-info__post-tasks">
        <% @post.tasks.each do |task|%>
          <% if task.done_flag.present? %>
            <li class='post-task-info'>
              <i class="fas fa-check"></i>
              <div class="post-task-title" style='text-decoration: line-through;'>
                <%= task.title %>
              </div>
            </li>
          <%else%>
            <li class='post-task-info'>
              <i class="fas fa-check" style='color: gray;'></i>
              <div class="post-task-title">
                <%= task.title %>
              </div>
            </li>
          <%end%>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% if user_signed_in? && current_user.id == @post.user.id %>
    <div class='post-info'>
      <div class='post-info__post-btns'>

        <%# TODO: 編集ページのturbolinks %>
        <%# <%= link_to "編集",edit_post_path(@post.id), data: {"turbolinks"=>false} %>
        <%= link_to "編集",edit_post_path(@post.id), class:'btn btn-info btn-lg post-edit-btn' %>
        <%= link_to "削除", post_path(@post.id), class:'btn btn-info btn-lg post-delete-btn', method: :delete%>
      </div>
    </div>
  <% end %>

  <div class="post-info">
    <div class='post-info__commentForm'>
      <% if user_signed_in? %>
        <%= form_with(model: [@post, @comment], local: true) do |f| %>
          <%= f.text_area :text, placeholder: "コメントする", rows: "2" , class: "form-control", id:'comment-form'%>
          <%= f.submit "コメント投稿", class:'btn btn-info btn-lg'%>
        <% end %>
      <% else %>
        <strong><p>※※※ コメントの投稿には新規登録/ログインが必要です ※※※</p></strong>
      <% end %>
    </div>
  </div>

  <div class="post-info">
    <div class="post-info__post-comments">
      <h4>＜コメント一覧＞</h4>
      <% if @comments %>
        <% @comments.each do |comment| %>
          <p>
            <strong><%= link_to comment.user.nickname, user_path(comment.user_id) %>：</strong><%= comment.text %>
          </p>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<%= javascript_include_tag 'post_map.js' %>
<%= javascript_include_tag 'post_image.js' %>
